function updateDialingPage()
    drawPage("Enter Gate Address", {
        {text = string.rep("-", 49), y = 3},
        {text = "Type address, then Enter", y = 5, centered = true},
        {text = "Address: " .. dialingAddress, y = 9, centered = true},
        {text = string.rep("-", 49), y = 17},
        {text = "[F1] Back", y = 18, centered = true}
    })
end

function updateAddressBookPage()
    local addressList = {}
    for name, data in pairs(addressBook) do
        if name:lower():find(searchQuery:lower()) or data.code:lower():find(searchQuery:lower()) or (data.tag or ""):lower():find(searchQuery:lower()) then
            table.insert(addressList, {name = name, code = data.code, isTrusted = data.isTrusted, tag = data.tag or ""})
        end
    end
    for i, addr in ipairs(recentAddresses) do
        if not addressBook[addr] and addr:lower():find(searchQuery:lower()) then
            table.insert(addressList, {name = "Recent " .. i, code = addr, isTrusted = false, tag = ""})
        end
    end
    local elements = {
        {text = string.rep("-", 49), y = 3},
        {text = "Search: " .. searchQuery, y = 4}
    }
    if #addressList == 0 then
        table.insert(elements, {text = "No addresses in book.", y = 5})
    else
        for i = 1, maxVisibleLines - 1 do
            local addrIndex = scrollPos + i - 1
            if addrIndex <= #addressList and addrIndex > 0 then
                local entry = addressList[addrIndex]
                if entry then
                    local trustMarker = entry.isTrusted and "[T]" or "[U]"
                    local blockMarker = config.BLOCKED_ADDRESSES[entry.code] and "[B]" or ""
                    local displayName = entry.name or "Unnamed"
                    local displayCode = entry.code or "NoCode"
                    local line = (addrIndex == selectedIndex and "> " or "  ") .. displayName .. " " .. trustMarker .. blockMarker .. ": " .. displayCode
                    table.insert(elements, {text = line, y = 5 + i, bgColor = addrIndex == selectedIndex and config.UI_COLORS.buttons})
                end
            end
        end
    end
    table.insert(elements, {text = string.rep("-", 49), y = 17})
    table.insert(elements, {text = "[A]dd  [S]ave  [T]rust  [B]lock  [C]lear  [D]ial  [Q]uery  [F1] Back", y = 18, x = 3})
    drawPage("Address Book", elements)
end

function updateAddAddressPage()
    drawPage("Add Address", {
        {text = string.rep("-", 49), y = 3},
        {text = "Type name, then Enter", y = 5, centered = true},
        {text = "Name: " .. addressName, y = 7, centered = true},
        {text = "Address: " .. addressCode, y = 9, centered = true},
        {text = string.rep("-", 49), y = 17},
        {text = "[F1] Back", y = 18, centered = true}
    })
end

function updateSearchPage()
    drawPage("Search Address Book", {
        {text = string.rep("-", 49), y = 3},
        {text = "Type query, then Enter", y = 5, centered = true},
        {text = "Query: " .. searchQuery, y = 9, centered = true},
        {text = string.rep("-", 49), y = 17},
        {text = "[F1] Back", y = 18, centered = true}
    })
end